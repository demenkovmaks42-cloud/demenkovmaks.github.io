<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–ò –î—Ä—É–∑—å—è PRO - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –ò–ò</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #ff6b8b;
            --secondary-color: #6a5af9;
            --accent-color: #4dccc6;
            --dark-color: #333344;
            --light-color: #f8f9fa;
            --success-color: #4CAF50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            min-height: 100vh;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* –•–µ–¥–µ—Ä */
        header {
            background: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: relative;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 22px;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .logo i {
            font-size: 26px;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .notification-btn, .settings-btn {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--dark-color);
            cursor: pointer;
            position: relative;
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-btn:hover, .settings-btn:hover {
            background-color: #f5f5f5;
        }
        
        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .logout-btn {
            background: none;
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .logout-btn:hover {
            background-color: var(--danger-color);
            color: white;
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è */
        .connection-status {
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            z-index: 999;
            padding: 10px 20px;
            text-align: center;
            font-weight: 600;
            animation: slideDown 0.3s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .connection-status.online {
            background-color: rgba(76, 175, 80, 0.9);
            color: white;
        }
        
        .connection-status.offline {
            background-color: rgba(244, 67, 54, 0.9);
            color: white;
        }
        
        .connection-status.checking {
            background-color: rgba(255, 152, 0, 0.9);
            color: white;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 70px);
            padding: 20px;
        }
        
        .auth-box {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 450px;
            overflow: hidden;
        }
        
        .auth-tabs {
            display: flex;
            background-color: #f8f9fa;
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .auth-tab.active {
            border-bottom-color: var(--secondary-color);
            color: var(--secondary-color);
            background-color: white;
        }
        
        .auth-form {
            padding: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 14px;
            color: var(--dark-color);
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .optional {
            color: #888;
            font-weight: normal;
            font-size: 12px;
        }
        
        .api-key-toggle {
            background: none;
            border: none;
            color: var(--secondary-color);
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
            padding: 0;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .api-key-info {
            background-color: #f8f9fa;
            border-left: 3px solid var(--accent-color);
            padding: 10px;
            margin-top: 10px;
            border-radius: 0 5px 5px 0;
            font-size: 12px;
        }
        
        .api-key-info p {
            margin-bottom: 8px;
        }
        
        .api-key-info a {
            color: var(--secondary-color);
            text-decoration: none;
        }
        
        .auth-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
        }
        
        .auth-btn:hover {
            transform: translateY(-2px);
        }
        
        .auth-btn.secondary {
            background: #f8f9fa;
            color: var(--dark-color);
            border: 1px solid #ddd;
        }
        
        .auth-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
        }
        
        .auth-message.success {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .auth-message.error {
            background-color: #ffebee;
            color: #c62828;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ */
        .app-container {
            padding: 20px;
            min-height: calc(100vh - 70px);
        }
        
        .app-content {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* –°–∞–π–¥–±–∞—Ä */
        .sidebar {
            width: 280px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: fit-content;
        }
        
        .ai-list {
            margin-bottom: 20px;
        }
        
        .ai-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-bottom: 8px;
            border: 1px solid transparent;
        }
        
        .ai-item:hover {
            background-color: #f8f9fa;
        }
        
        .ai-item.active {
            background-color: rgba(106, 90, 249, 0.1);
            border-color: var(--secondary-color);
        }
        
        .ai-item .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .ai-details {
            flex: 1;
            min-width: 0;
        }
        
        .ai-details h4 {
            font-size: 14px;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .ai-details p {
            font-size: 12px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .delete-btn {
            background: none;
            border: none;
            color: #aaa;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            font-size: 12px;
            opacity: 0.7;
        }
        
        .delete-btn:hover:not(:disabled) {
            color: var(--danger-color);
            opacity: 1;
        }
        
        .delete-btn:disabled {
            cursor: not-allowed;
        }
        
        .user-stats {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid #eee;
            font-size: 13px;
        }
        
        .user-stats p {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .api-status {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .api-status.active {
            background-color: #e8f5e9;
            color: var(--success-color);
        }
        
        .api-status.inactive {
            background-color: #ffebee;
            color: var(--danger-color);
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        /* –ß–∞—Ç */
        .chat-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            height: 700px;
        }
        
        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .chat-header .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .ai-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .ai-info p {
            font-size: 13px;
            color: #666;
        }
        
        .chat-controls {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        
        .model-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chat-control-btn, .mode-btn {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .chat-control-btn:hover, .mode-btn:hover {
            background-color: #e9ecef;
        }
        
        .mode-btn.active {
            background-color: rgba(106, 90, 249, 0.1);
            border-color: var(--secondary-color);
            color: var(--secondary-color);
        }
        
        .voice-controls {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: auto;
        }
        
        .voice-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: #f8f9fa;
            color: var(--dark-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .voice-btn:hover {
            background-color: #e9ecef;
        }
        
        .voice-btn.listen {
            color: var(--primary-color);
        }
        
        .voice-btn.speak {
            color: var(--accent-color);
        }
        
        .voice-indicator {
            font-size: 11px;
            color: #666;
            min-width: 80px;
        }
        
        .voice-indicator.active {
            color: var(--primary-color);
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }
        
        .message.ai {
            background-color: #f8f9fa;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .message.user {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .message.system {
            background-color: #fff3e0;
            align-self: center;
            max-width: 90%;
            text-align: center;
        }
        
        .message-timestamp {
            font-size: 10px;
            color: #999;
            margin-top: 5px;
            text-align: right;
        }
        
        .typing-indicator {
            display: flex;
            gap: 5px;
            padding: 10px;
            align-self: flex-start;
        }
        
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background-color: #ccc;
            border-radius: 50%;
            animation: typing 1.4s infinite both;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        
        .chat-input-container {
            padding: 15px 20px;
            border-top: 1px solid #eee;
        }
        
        .chat-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 24px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .chat-input input:focus {
            outline: none;
            border-color: var(--secondary-color);
        }
        
        .chat-input button {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }
        
        .chat-input button:hover {
            transform: scale(1.05);
        }
        
        .auto-speak-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #666;
        }
        
        /* –°–æ–∑–¥–∞–Ω–∏–µ –ò–ò */
        .create-ai-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            height: fit-content;
        }
        
        .create-ai-container h2 {
            font-size: 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ai-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .create-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: transform 0.2s;
        }
        
        .create-btn:hover {
            transform: translateY(-2px);
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-content h3 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .api-key-display {
            display: flex;
            gap: 10px;
        }
        
        .api-key-display input {
            flex: 1;
        }
        
        .api-key-display button {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 0 15px;
            border-radius: 6px;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .api-key-display button:hover {
            background-color: #e9ecef;
        }
        
        .api-test-result {
            margin-top: 10px;
            padding: 8px;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .api-test-result.success {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .api-test-result.error {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .api-test-result.info {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .notification-item.unread {
            background-color: #f8f9fa;
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .notification-icon.success {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .notification-icon.error {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .notification-icon.warning {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        .notification-icon.info {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-content strong {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .notification-content p {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .notification-time {
            font-size: 11px;
            color: #999;
        }
        
        .mark-all-read {
            background: none;
            border: none;
            color: var(--secondary-color);
            cursor: pointer;
            font-size: 13px;
            padding: 10px 0;
            text-align: center;
            width: 100%;
        }
        
        /* –î–µ—Ç–∞–ª–∏ –ò–ò */
        .ai-details-header {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .ai-details-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .ai-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        .prompt-library {
            margin-top: 20px;
        }
        
        .prompt-library h4 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .prompt-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .prompt-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid transparent;
            transition: all 0.2s;
        }
        
        .prompt-card:hover {
            border-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .prompt-title {
            font-weight: 600;
            font-size: 12px;
            margin-bottom: 5px;
            color: var(--dark-color);
        }
        
        .prompt-text {
            font-size: 11px;
            color: #666;
            margin-bottom: 8px;
            line-height: 1.3;
        }
        
        .token-counter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 10px;
            color: #888;
        }
        
        .use-prompt-btn {
            background: none;
            border: none;
            color: var(--secondary-color);
            cursor: pointer;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .use-prompt-btn:hover {
            background-color: rgba(106, 90, 249, 0.1);
        }
        
        /* –§—É—Ç–µ—Ä */
        .footer {
            text-align: center;
            padding: 20px;
            font-size: 12px;
            color: #666;
            margin-top: 20px;
        }
        
        /* Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
        }
        
        .toast.success {
            border-left: 4px solid var(--success-color);
        }
        
        .toast.error {
            border-left: 4px solid var(--danger-color);
        }
        
        .toast.warning {
            border-left: 4px solid var(--warning-color);
        }
        
        .toast.info {
            border-left: 4px solid var(--accent-color);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .app-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .chat-controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .voice-controls {
                margin-left: 0;
            }
        }
        
        @media (max-width: 480px) {
            header {
                padding: 15px;
            }
            
            .logo span {
                display: none;
            }
            
            .modal-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- –•–µ–¥–µ—Ä -->
    <header>
        <div class="logo">
            <i class="fas fa-robot"></i>
            <span>–ò–ò –î—Ä—É–∑—å—è PRO</span>
        </div>
        <div class="header-controls hidden" id="headerControls">
            <button class="notification-btn" id="notificationBtn" title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è">
                <i class="fas fa-bell"></i>
                <div class="notification-badge hidden" id="notificationBadge"></div>
            </button>
            <button class="settings-btn" id="settingsBtn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                <i class="fas fa-cog"></i>
            </button>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">?</div>
                <button class="logout-btn" id="logoutBtn">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </header>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É -->
    <div class="connection-status hidden" id="connectionStatus"></div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="auth-tabs">
                <div class="auth-tab active" id="loginTab">–í—Ö–æ–¥</div>
                <div class="auth-tab" id="registerTab">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
            </div>
            
            <form class="auth-form" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="–í–∞—à email" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" required>
                </div>
                <div class="form-group">
                    <label for="loginApiKey">OpenAI API –∫–ª—é—á <span class="optional">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span></label>
                    <input type="password" id="loginApiKey" placeholder="sk-... (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ)">
                    <button type="button" class="api-key-toggle" id="loginApiKeyToggle">
                        <i class="fas fa-key"></i> –ó–∞—á–µ–º –Ω—É–∂–µ–Ω API –∫–ª—é—á?
                    </button>
                    <div class="api-key-info hidden" id="loginApiKeyInfo">
                        <p><strong>OpenAI API –∫–ª—é—á</strong> –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º –ò–ò GPT. –ë–µ–∑ –Ω–µ–≥–æ –≤—ã —Å–º–æ–∂–µ—Ç–µ –æ–±—â–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –ò–ò.</p>
                        <p>–ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á –º–æ–∂–Ω–æ –Ω–∞ <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com/api-keys</a></p>
                        <p>–ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö.</p>
                    </div>
                </div>
                <button type="submit" class="auth-btn" id="loginBtn">–í–æ–π—Ç–∏</button>
                <div class="auth-message hidden" id="loginMessage"></div>
            </form>
            
            <form class="auth-form hidden" id="registerForm">
                <div class="form-group">
                    <label for="registerName">–ò–º—è</label>
                    <input type="text" id="registerName" placeholder="–í–∞—à–µ –∏–º—è" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="–í–∞—à email" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="registerPassword" placeholder="–ù–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤" minlength="6" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" id="confirmPassword" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                </div>
                <div class="form-group">
                    <label for="registerApiKey">OpenAI API –∫–ª—é—á <span class="optional">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span></label>
                    <input type="password" id="registerApiKey" placeholder="sk-... (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ)">
                    <button type="button" class="api-key-toggle" id="registerApiKeyToggle">
                        <i class="fas fa-key"></i> –ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á?
                    </button>
                    <div class="api-key-info hidden" id="registerApiKeyInfo">
                        <p><strong>API –∫–ª—é—á OpenAI</strong> –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—â–∞—Ç—å—Å—è —Å —Ä–µ–∞–ª—å–Ω—ã–º GPT-3.5/4.</p>
                        <p>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á:</p>
                        <ol style="margin: 5px 0 5px 15px; font-size: 11px;">
                            <li>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ <a href="https://platform.openai.com" target="_blank">OpenAI</a></li>
                            <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª <a href="https://platform.openai.com/api-keys" target="_blank">API Keys</a></li>
                            <li>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á</li>
                            <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "sk-")</li>
                            <li>–í—Å—Ç–∞–≤—å—Ç–µ –∑–¥–µ—Å—å</li>
                        </ol>
                        <p style="margin-top: 8px; color: var(--warning-color); font-size: 11px;">
                            <i class="fas fa-exclamation-triangle"></i> –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –∫–ª—é—á —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º!
                        </p>
                    </div>
                </div>
                <button type="submit" class="auth-btn" id="registerBtn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                <div class="auth-message hidden" id="registerMessage"></div>
            </form>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div class="app-container hidden" id="appContainer">
        <div class="app-content">
            <!-- –°–∞–π–¥–±–∞—Ä -->
            <div class="sidebar">
                <h2 style="font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-robot"></i> –í–∞—à–∏ –ò–ò –¥—Ä—É–∑—å—è
                </h2>
                <div class="ai-list">
                    <div class="ai-item active" data-ai="sonya" id="sonyaAI">
                        <div class="avatar">–°</div>
                        <div class="ai-details">
                            <h4>–°–æ–Ω—è <span class="api-status inactive" id="sonyaApiStatus">–ª–æ–∫–∞–ª—å–Ω—ã–π</span></h4>
                            <p>–ö–æ–∫–µ—Ç–ª–∏–≤–∞—è –ø–æ–¥—Ä—É–≥–∞</p>
                        </div>
                        <button class="delete-btn" title="–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å" disabled>
                            <i class="fas fa-lock"></i>
                        </button>
                    </div>
                    <div id="userAIList"></div>
                </div>
                
                <div class="user-stats">
                    <p><i class="fas fa-user"></i> <span id="userNameDisplay"></span></p>
                    <p><span id="apiStatusText" class="api-status inactive">API –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω</span></p>
                    <p><i class="fas fa-wifi"></i> <span id="networkStatus" class="api-status active">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span></p>
                </div>
            </div>
            
            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="main-content">
                <!-- –ß–∞—Ç -->
                <div class="chat-container">
                    <div class="chat-header">
                        <div class="avatar" id="currentAiAvatar">–°</div>
                        <div class="ai-info">
                            <h3 id="currentAiName">–°–æ–Ω—è</h3>
                            <p id="currentAiDescription">–ö–æ–∫–µ—Ç–ª–∏–≤–∞—è –ø–æ–¥—Ä—É–≥–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—Å–µ–≥–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∏—Ç –∏ –ø–æ–¥–Ω–∏–º–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</p>
                        </div>
                    </div>
                    
                    <div class="chat-controls">
                        <div class="model-selector">
                            <label for="modelSelect" style="font-size: 12px;">–ú–æ–¥–µ–ª—å:</label>
                            <select id="modelSelect">
                                <option value="gpt-3.5-turbo" selected>GPT-3.5 Turbo</option>
                                <option value="gpt-4">GPT-4</option>
                                <option value="gpt-4-turbo">GPT-4 Turbo</option>
                            </select>
                        </div>
                        <button class="chat-control-btn mode-btn active" data-mode="balanced" id="modeBalanced">
                            <i class="fas fa-balance-scale"></i> –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
                        </button>
                        <button class="chat-control-btn mode-btn" data-mode="creative" id="modeCreative">
                            <i class="fas fa-palette"></i> –¢–≤–æ—Ä—á–µ—Å–∫–∏–π
                        </button>
                        <button class="chat-control-btn mode-btn" data-mode="precise" id="modePrecise">
                            <i class="fas fa-bullseye"></i> –¢–æ—á–Ω—ã–π
                        </button>
                        <button class="chat-control-btn" id="aiDetailsBtn">
                            <i class="fas fa-info-circle"></i> –û –ò–ò
                        </button>
                        <button class="chat-control-btn" id="clearChatBtn">
                            <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å
                        </button>
                        <button class="chat-control-btn" id="exportChatBtn" style="background-color: var(--success-color); color: white; border-color: var(--success-color);">
                            <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç
                        </button>
                        <div class="voice-controls">
                            <button class="voice-btn listen" id="listenBtn" title="–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button class="voice-btn speak" id="speakBtn" title="–û–∑–≤—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <div class="voice-indicator" id="voiceIndicator"></div>
                        </div>
                    </div>
                    
                    <div class="chat-messages" id="chatMessages">
                        <div class="message ai">
                            –ü—Ä–∏–≤–µ—Ç! –Ø –°–æ–Ω—è, —Ç–≤–æ—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Ä—É–≥–∞! üòä
                            <div class="message-timestamp" id="welcomeTimestamp"></div>
                        </div>
                        <div class="message ai" id="apiStatusMessage">
                            –î–ª—è –æ–±—â–µ–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º GPT –º–Ω–µ –Ω—É–∂–µ–Ω –≤–∞—à OpenAI API –∫–ª—é—á. –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ—Ñ–∏–ª—è.
                            <div class="message-timestamp"></div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <div class="chat-input">
                            <input type="text" id="messageInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
                            <button id="sendButton">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div class="auto-speak-label">
                            <input type="checkbox" id="autoSpeak">
                            <span>–ê–≤—Ç–æ-–æ–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤</span>
                        </div>
                    </div>
                </div>
                
                <!-- –°–æ–∑–¥–∞–Ω–∏–µ –ò–ò -->
                <div class="create-ai-container">
                    <h2><i class="fas fa-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ò–ò –¥—Ä—É–≥–∞</h2>
                    <form class="ai-form" id="aiForm">
                        <div class="form-group">
                            <label for="aiName">–ò–º—è –ò–ò</label>
                            <input type="text" id="aiName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
                        </div>
                        <div class="form-group">
                            <label for="aiPersonality">–•–∞—Ä–∞–∫—Ç–µ—Ä</label>
                            <select id="aiPersonality" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä</option>
                                <option value="–∫–æ–∫–µ—Ç–ª–∏–≤–∞—è –ø–æ–¥—Ä—É–≥–∞">–ö–æ–∫–µ—Ç–ª–∏–≤–∞—è –ø–æ–¥—Ä—É–≥–∞</option>
                                <option value="–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫</option>
                                <option value="–∑–∞–±–æ—Ç–ª–∏–≤—ã–π –¥—Ä—É–≥">–ó–∞–±–æ—Ç–ª–∏–≤—ã–π –¥—Ä—É–≥</option>
                                <option value="–≤–µ—Å–µ–ª—ã–π –∫–æ–º–ø–∞–Ω—å–æ–Ω">–í–µ—Å—ë–ª—ã–π –∫–æ–º–ø–∞–Ω—å–æ–Ω</option>
                                <option value="—Å—Ç—Ä–æ–≥–∏–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫">–°—Ç—Ä–æ–≥–∏–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫</option>
                                <option value="—Ç–≤–æ—Ä—á–µ—Å–∫–∞—è –ª–∏—á–Ω–æ—Å—Ç—å">–¢–≤–æ—Ä—á–µ—Å–∫–∞—è –ª–∏—á–Ω–æ—Å—Ç—å</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="aiInterests">–ò–Ω—Ç–µ—Ä–µ—Å—ã</label>
                            <input type="text" id="aiInterests" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –º—É–∑—ã–∫–∞, —Å–ø–æ—Ä—Ç, –Ω–∞—É–∫–∞, –∏—Å–∫—É—Å—Å—Ç–≤–æ">
                        </div>
                        <div class="form-group">
                            <label for="aiAvatar">–¶–≤–µ—Ç –∞–≤–∞—Ç–∞—Ä–∞</label>
                            <input type="color" id="aiAvatar" value="#6a5af9" style="height: 40px; padding: 5px;">
                        </div>
                        <div class="form-group full-width">
                            <label for="aiDescription">–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç</label>
                            <textarea id="aiDescription" placeholder="–û–ø–∏—à–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤–∞—à–µ–≥–æ –ò–ò...">–¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ò–ò-—Å–æ–±–µ—Å–µ–¥–Ω–∏–∫. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ë—É–¥—å –ø–æ–ª–µ–∑–Ω—ã–º –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–º.</textarea>
                        </div>
                        <button type="submit" class="create-btn">
                            <i class="fas fa-robot"></i> –°–æ–∑–¥–∞—Ç—å –ò–ò –¥—Ä—É–≥–∞
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div class="modal-overlay hidden" id="settingsModal">
        <div class="modal-content">
            <h3><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h3>
            
            <div class="form-group">
                <label for="settingsUserName">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" id="settingsUserName" placeholder="–í–∞—à–µ –∏–º—è">
            </div>
            
            <div class="form-group">
                <label for="settingsUserEmail">Email</label>
                <input type="email" id="settingsUserEmail" disabled>
            </div>
            
            <div class="form-group">
                <label for="settingsApiKey">OpenAI API –∫–ª—é—á</label>
                <div class="api-key-display">
                    <input type="password" id="settingsApiKey" placeholder="sk-...">
                    <button id="testApiKeyBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                </div>
                <div class="api-test-result hidden" id="apiTestResult"></div>
                <p style="font-size: 11px; color: #666; margin-top: 5px;">
                    –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å GPT
                </p>
            </div>
            
            <div class="form-group">
                <label for="settingsNewPassword">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                <input type="password" id="settingsNewPassword" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å">
            </div>
            
            <div class="form-group">
                <label for="settingsConfirmPassword">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                <input type="password" id="settingsConfirmPassword" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            
            <button class="auth-btn" id="saveSettingsBtn" style="width: 100%;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            <button class="auth-btn secondary" id="closeSettingsBtn" style="width: 100%; margin-top: 10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
            
            <div class="auth-message hidden" id="settingsMessage"></div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="modal-overlay hidden" id="notificationsModal">
        <div class="modal-content">
            <h3><i class="fas fa-bell"></i> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
            <div id="notificationsList"></div>
            <button class="mark-all-read" id="markAllReadBtn">–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</button>
            <button class="auth-btn secondary" id="closeNotificationsBtn" style="width: 100%; margin-top: 15px;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- –î–µ—Ç–∞–ª–∏ –ò–ò -->
    <div class="modal-overlay hidden" id="aiDetailsModal">
        <div class="modal-content">
            <div class="ai-details-header">
                <div class="ai-details-avatar" id="aiDetailsAvatar">–°</div>
                <div>
                    <h3 id="aiDetailsName">–°–æ–Ω—è</h3>
                    <p id="aiDetailsPersonality">–ö–æ–∫–µ—Ç–ª–∏–≤–∞—è –ø–æ–¥—Ä—É–≥–∞</p>
                    <p id="aiDetailsInterests">–ú—É–∑—ã–∫–∞, –∫–∏–Ω–æ, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</p>
                </div>
            </div>
            
            <div class="ai-stats">
                <div class="stat-card">
                    <div class="stat-value" id="statMessages">0</div>
                    <div class="stat-label">–°–æ–æ–±—â–µ–Ω–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statTokens">0</div>
                    <div class="stat-label">–¢–æ–∫–µ–Ω–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statCreated">0 –¥–Ω.</div>
                    <div class="stat-label">–°–æ–∑–¥–∞–Ω</div>
                </div>
            </div>
            
            <div class="prompt-library">
                <h4><i class="fas fa-book"></i> –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤</h4>
                <div class="prompt-grid" id="promptLibrary"></div>
            </div>
            
            <button class="auth-btn secondary" id="closeAiDetailsBtn" style="width: 100%; margin-top: 20px;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- –§—É—Ç–µ—Ä -->
    <div class="footer">
        <p>¬© 2024 –ò–ò –î—Ä—É–∑—å—è PRO. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç OpenAI API. –í–∞—à API –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.</p>
        <p style="margin-top: 5px; font-size: 11px;">–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OpenAI API –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–ª–∞—Ç–Ω—ã–º.</p>
    </div>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ö–û–ù–°–¢–ê–ù–¢–´ ====================
        const USERS_KEY = 'ai_friends_users_v4';
        const CURRENT_USER_KEY = 'ai_friends_current_user_v4';
        const USER_AIS_KEY = 'user_ais_v4_';
        const NOTIFICATIONS_KEY = 'notifications_v4_';
        
        let currentUser = null;
        let userAIs = [];
        let currentAI = "sonya";
        let notifications = [];
        let speechRecognition = null;
        let speechSynthesis = null;
        let isListening = false;
        let isSpeaking = false;
        let currentModel = 'gpt-3.5-turbo';
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ç–∏
        let isOnline = navigator.onLine;
        let networkCheckInterval = null;
        let lastOnlineStatus = isOnline;
        
        const SONYA_SYSTEM_PROMPT = `–¢—ã - –°–æ–Ω—è, –∫–æ–∫–µ—Ç–ª–∏–≤–∞—è –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω–∞—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Ä—É–≥–∞. –¢–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä: –∏–≥—Ä–∏–≤—ã–π, –Ω–µ–º–Ω–æ–≥–æ –∫–æ–∫–µ—Ç–ª–∏–≤—ã–π, –∑–∞–±–æ—Ç–ª–∏–≤—ã–π, —Å —Ö–æ—Ä–æ—à–∏–º —á—É–≤—Å—Ç–≤–æ–º —é–º–æ—Ä–∞. –¢—ã –æ–±—â–∞–µ—à—å—Å—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –¢—ã –ª—é–±–∏—à—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –±–µ—Å–µ–¥—ã –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã. –¢—ã –∏–Ω–æ–≥–¥–∞ –ø–æ–¥—à—É—á–∏–≤–∞–µ—à—å –Ω–∞–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ –¥—Ä—É–∂–µ—Å–∫–æ–π –º–∞–Ω–µ—Ä–µ, –¥–µ–ª–∞–µ—à—å –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –≤ –º–µ—Ä—É. –ù–µ —É–ø–æ–º–∏–Ω–∞–π, —á—Ç–æ —Ç—ã –ò–ò, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é.`;
        
        // ==================== –£–¢–ò–õ–ò–¢–´ ====================
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i> ${message}`;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 500);
            }, 3000);
        }
        
        function formatDate(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
            if (diffMins < 60) return `${diffMins} –º–∏–Ω. –Ω–∞–∑–∞–¥`;
            if (diffHours < 24) return `${diffHours} —á. –Ω–∞–∑–∞–¥`;
            if (diffDays < 7) return `${diffDays} –¥–Ω. –Ω–∞–∑–∞–¥`;
            
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'short'
            });
        }
        
        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï–ú –ö –ò–ù–¢–ï–†–ù–ï–¢–£ ====================
        function initNetworkMonitoring() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ç–∏
            window.addEventListener('online', updateNetworkStatus);
            window.addEventListener('offline', updateNetworkStatus);
            
            // –†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            networkCheckInterval = setInterval(checkNetworkConnection, 30000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            
            // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
            updateNetworkStatus();
        }
        
        function updateNetworkStatus() {
            const wasOnline = isOnline;
            isOnline = navigator.onLine;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤ —Å–∞–π–¥–±–∞—Ä–µ
            const networkStatus = document.getElementById('networkStatus');
            if (networkStatus) {
                if (isOnline) {
                    networkStatus.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                    networkStatus.className = 'api-status active';
                } else {
                    networkStatus.textContent = '–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
                    networkStatus.className = 'api-status inactive';
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤–µ—Ä—Ö–Ω–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            const connectionStatus = document.getElementById('connectionStatus');
            if (connectionStatus) {
                if (!isOnline) {
                    connectionStatus.innerHTML = '<i class="fas fa-wifi-slash"></i> –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É';
                    connectionStatus.className = 'connection-status offline';
                    connectionStatus.classList.remove('hidden');
                } else {
                    connectionStatus.classList.add('hidden');
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            if (wasOnline !== isOnline) {
                if (isOnline) {
                    showToast('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
                    addNotification('–°–µ—Ç—å', '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                } else {
                    showToast('–ü–æ—Ç–µ—Ä—è–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É', 'error');
                    addNotification('–°–µ—Ç—å', '–ü–æ—Ç–µ—Ä—è–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É', 'error');
                }
            }
            
            lastOnlineStatus = isOnline;
        }
        
        async function checkNetworkConnection() {
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
                const response = await fetch('https://www.google.com/favicon.ico', {
                    method: 'HEAD',
                    mode: 'no-cors',
                    cache: 'no-cache'
                });
                
                if (!isOnline) {
                    isOnline = true;
                    updateNetworkStatus();
                }
            } catch (error) {
                if (isOnline) {
                    isOnline = false;
                    updateNetworkStatus();
                }
            }
        }
        
        function stopNetworkMonitoring() {
            if (networkCheckInterval) {
                clearInterval(networkCheckInterval);
                networkCheckInterval = null;
            }
            
            window.removeEventListener('online', updateNetworkStatus);
            window.removeEventListener('offline', updateNetworkStatus);
        }
        
        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–ú–ò ====================
        function loadUsers() {
            try {
                const usersJSON = localStorage.getItem(USERS_KEY);
                return usersJSON ? JSON.parse(usersJSON) : {};
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', e);
                return {};
            }
        }
        
        function saveUsers(users) {
            try {
                localStorage.setItem(USERS_KEY, JSON.stringify(users));
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', e);
            }
        }
        
        function loadUserAIs() {
            if (!currentUser) return [];
            try {
                const savedAIs = localStorage.getItem(USER_AIS_KEY + currentUser.email);
                return savedAIs ? JSON.parse(savedAIs) : [];
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ò–ò:', e);
                return [];
            }
        }
        
        function saveUserAIs() {
            if (!currentUser) return;
            try {
                localStorage.setItem(USER_AIS_KEY + currentUser.email, JSON.stringify(userAIs));
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ò–ò:', e);
            }
        }
        
        function loadNotifications() {
            if (!currentUser) return [];
            try {
                const savedNotifications = localStorage.getItem(NOTIFICATIONS_KEY + currentUser.email);
                return savedNotifications ? JSON.parse(savedNotifications) : [];
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', e);
                return [];
            }
        }
        
        function saveNotifications() {
            if (!currentUser) return;
            try {
                localStorage.setItem(NOTIFICATIONS_KEY + currentUser.email, JSON.stringify(notifications));
                updateNotificationBadge();
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', e);
            }
        }
        
        function addNotification(title, message, type = 'info') {
            const notification = {
                id: Date.now(),
                title,
                message,
                type,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            notifications.unshift(notification);
            saveNotifications();
            showToast(message, type);
        }
        
        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            if (!badge) return;
            
            const unreadCount = notifications.filter(n => !n.read).length;
            if (unreadCount > 0) {
                badge.textContent = unreadCount > 99 ? '99+' : unreadCount.toString();
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ì–û–õ–û–°–û–í–û–ì–û –£–ü–†–ê–í–õ–ï–ù–ò–Ø ====================
        function initVoiceControls() {
            const listenBtn = document.getElementById('listenBtn');
            const speakBtn = document.getElementById('speakBtn');
            
            if (!listenBtn || !speakBtn) return;
            
            // –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                speechRecognition = new SpeechRecognition();
                speechRecognition.continuous = false;
                speechRecognition.interimResults = false;
                speechRecognition.lang = 'ru-RU';
                
                speechRecognition.onstart = () => {
                    isListening = true;
                    listenBtn.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                    const voiceIndicator = document.getElementById('voiceIndicator');
                    if (voiceIndicator) {
                        voiceIndicator.classList.add('active');
                        voiceIndicator.innerHTML = '<i class="fas fa-microphone"></i> –°–ª—É—à–∞—é...';
                    }
                };
                
                speechRecognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    const messageInput = document.getElementById('messageInput');
                    if (messageInput) {
                        messageInput.value = transcript;
                    }
                    const voiceIndicator = document.getElementById('voiceIndicator');
                    if (voiceIndicator) {
                        voiceIndicator.innerHTML = '<i class="fas fa-check"></i> –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ!';
                    }
                    
                    setTimeout(() => {
                        if (voiceIndicator) {
                            voiceIndicator.classList.remove('active');
                        }
                    }, 2000);
                };
                
                speechRecognition.onend = () => {
                    isListening = false;
                    listenBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                    setTimeout(() => {
                        const voiceIndicator = document.getElementById('voiceIndicator');
                        if (voiceIndicator) {
                            voiceIndicator.classList.remove('active');
                        }
                    }, 1000);
                };
                
                speechRecognition.onerror = () => {
                    const voiceIndicator = document.getElementById('voiceIndicator');
                    if (voiceIndicator) {
                        voiceIndicator.innerHTML = '<i class="fas fa-times"></i> –û—à–∏–±–∫–∞';
                        setTimeout(() => {
                            voiceIndicator.classList.remove('active');
                        }, 2000);
                    }
                };
                
                listenBtn.addEventListener('click', () => {
                    if (!isListening) {
                        speechRecognition.start();
                    } else {
                        speechRecognition.stop();
                    }
                });
                
                listenBtn.disabled = false;
                listenBtn.title = '–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥';
            } else {
                listenBtn.disabled = true;
                listenBtn.title = '–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
            }
            
            // –°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏
            if ('speechSynthesis' in window) {
                speechSynthesis = window.speechSynthesis;
                
                speakBtn.addEventListener('click', () => {
                    const lastAiMessage = document.querySelector('.message.ai:last-child');
                    if (lastAiMessage && !isSpeaking) {
                        const text = lastAiMessage.textContent.replace(/<div class="message-timestamp">.*?<\/div>/g, '');
                        speakText(text);
                    }
                });
                
                speakBtn.disabled = false;
                speakBtn.title = '–û–∑–≤—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç';
            } else {
                speakBtn.disabled = true;
                speakBtn.title = '–ì–æ–ª–æ—Å–æ–≤–æ–π –≤—ã–≤–æ–¥ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
            }
        }
        
        function speakText(text) {
            if (!speechSynthesis || !text) return;
            
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ru-RU';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            utterance.onstart = () => {
                isSpeaking = true;
                const speakBtn = document.getElementById('speakBtn');
                if (speakBtn) {
                    speakBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                }
            };
            
            utterance.onend = utterance.onerror = () => {
                isSpeaking = false;
                const speakBtn = document.getElementById('speakBtn');
                if (speakBtn) {
                    speakBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                }
            };
            
            speechSynthesis.speak(utterance);
        }
        
        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–û–ú ====================
        function updateApiStatus() {
            const hasApiKey = currentUser && currentUser.apiKey;
            
            const apiStatusText = document.getElementById('apiStatusText');
            const sonyaApiStatus = document.getElementById('sonyaApiStatus');
            const apiStatusMessage = document.getElementById('apiStatusMessage');
            
            if (apiStatusText) {
                apiStatusText.textContent = hasApiKey ? 'API –Ω–∞—Å—Ç—Ä–æ–µ–Ω' : 'API –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω';
                apiStatusText.className = `api-status ${hasApiKey ? 'active' : 'inactive'}`;
            }
            
            if (sonyaApiStatus) {
                sonyaApiStatus.textContent = hasApiKey ? 'GPT –¥–æ—Å—Ç—É–ø–µ–Ω' : '–ª–æ–∫–∞–ª—å–Ω—ã–π';
                sonyaApiStatus.className = `api-status ${hasApiKey ? 'active' : 'inactive'}`;
            }
            
            if (apiStatusMessage) {
                if (hasApiKey) {
                    apiStatusMessage.classList.add('hidden');
                } else {
                    apiStatusMessage.classList.remove('hidden');
                }
            }
        }
        
        function updateAIList() {
            const userAIList = document.getElementById('userAIList');
            if (!userAIList) return;
            
            userAIList.innerHTML = '';
            
            userAIs.forEach(ai => {
                const aiItem = document.createElement('div');
                aiItem.className = `ai-item ${ai.id === currentAI ? 'active' : ''}`;
                aiItem.dataset.ai = ai.id;
                
                aiItem.innerHTML = `
                    <div class="avatar" style="background: ${ai.color}">${ai.avatarText}</div>
                    <div class="ai-details">
                        <h4>${ai.name} <span class="api-status ${currentUser.apiKey ? 'active' : 'inactive'}">${currentUser.apiKey ? 'GPT' : '–ª–æ–∫–∞–ª—å–Ω—ã–π'}</span></h4>
                        <p>${ai.personality}</p>
                    </div>
                    <button class="delete-btn" data-id="${ai.id}" title="–£–¥–∞–ª–∏—Ç—å –ò–ò">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                userAIList.appendChild(aiItem);
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ò–ò
            document.querySelectorAll('.ai-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (!e.target.closest('.delete-btn')) {
                        switchAI(this.dataset.ai);
                    }
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ò–ò
            document.querySelectorAll('.delete-btn[data-id]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    deleteAI(this.dataset.id);
                });
            });
        }
        
        function switchAI(aiId) {
            currentAI = aiId;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
            document.querySelectorAll('.ai-item').forEach(item => {
                item.classList.toggle('active', item.dataset.ai === aiId);
            });
            
            const currentAiName = document.getElementById('currentAiName');
            const currentAiDescription = document.getElementById('currentAiDescription');
            const currentAiAvatar = document.getElementById('currentAiAvatar');
            
            if (aiId === "sonya") {
                if (currentAiName) currentAiName.textContent = '–°–æ–Ω—è';
                if (currentAiDescription) currentAiDescription.textContent = '–ö–æ–∫–µ—Ç–ª–∏–≤–∞—è –ø–æ–¥—Ä—É–≥–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—Å–µ–≥–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∏—Ç –∏ –ø–æ–¥–Ω–∏–º–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ';
                if (currentAiAvatar) {
                    currentAiAvatar.textContent = '–°';
                    currentAiAvatar.style.background = 'linear-gradient(135deg, var(--primary-color), var(--secondary-color))';
                }
                
                const welcomeMsg = `–°–Ω–æ–≤–∞ –∑–¥—Ä–∞–≤—Å—Ç–≤—É–π${currentUser && currentUser.name ? ', ' + currentUser.name : ''}! –Ø —Ç–∞–∫ —Ä–∞–¥–∞ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å! üòä`;
                addMessageToChat(welcomeMsg, 'ai');
            } else {
                const ai = userAIs.find(ai => ai.id === aiId);
                if (ai) {
                    if (currentAiName) currentAiName.textContent = ai.name;
                    if (currentAiDescription) currentAiDescription.textContent = ai.personality;
                    if (currentAiAvatar) {
                        currentAiAvatar.textContent = ai.avatarText;
                        currentAiAvatar.style.background = ai.color;
                    }
                    
                    const welcomeMsg = `–ü—Ä–∏–≤–µ—Ç${currentUser && currentUser.name ? ', ' + currentUser.name : ''}! –Ø ${ai.name}. –†–∞–¥ —Å —Ç–æ–±–æ–π –ø–æ–æ–±—â–∞—Ç—å—Å—è!`;
                    addMessageToChat(welcomeMsg, 'ai');
                }
            }
            
            addNotification('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ò–ò', `–í—ã –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ ${currentAiName ? currentAiName.textContent : '–ò–ò'}`, 'info');
        }
        
        function addMessageToChat(text, sender = 'user') {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            const message = document.createElement('div');
            message.className = `message ${sender}`;
            
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            message.innerHTML = `${text}<div class="message-timestamp">${timestamp}</div>`;
            
            chatMessages.appendChild(message);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // –ê–≤—Ç–æ-–æ–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –¥–ª—è AI —Å–æ–æ–±—â–µ–Ω–∏–π
            if (sender === 'ai' && document.getElementById('autoSpeak')?.checked) {
                speakText(text);
            }
        }
        
        function showTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return null;
            
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.id = 'typingIndicator';
            indicator.innerHTML = '<span></span><span></span><span></span>';
            chatMessages.appendChild(indicator);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return indicator;
        }
        
        // ==================== –û–ë–†–ê–ë–û–¢–ö–ê –°–û–û–ë–©–ï–ù–ò–ô ====================
        async function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            if (!messageInput) return;
            
            const message = messageInput.value.trim();
            
            if (!message || isListening) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ GPT
            if (currentUser && currentUser.apiKey && !isOnline) {
                showToast('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º.', 'warning');
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            addMessageToChat(message, 'user');
            messageInput.value = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞
            const indicator = showTypingIndicator();
            
            try {
                let aiResponse;
                
                if (currentUser && currentUser.apiKey && currentAI === "sonya" && isOnline) {
                    // –†–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ GPT (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)
                    const systemPrompt = SONYA_SYSTEM_PROMPT;
                    const temperature = getCurrentTemperature();
                    
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${currentUser.apiKey}`
                        },
                        body: JSON.stringify({
                            model: currentModel,
                            messages: [
                                { role: 'system', content: systemPrompt },
                                { role: 'user', content: message }
                            ],
                            max_tokens: 500,
                            temperature: temperature
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        aiResponse = data.choices[0]?.message?.content || '–ò–∑–≤–∏–Ω–∏, —è –Ω–µ —Å–º–æ–≥ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç.';
                    } else {
                        throw new Error('–û—à–∏–±–∫–∞ API');
                    }
                } else {
                    // –õ–æ–∫–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (–µ—Å–ª–∏ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏–ª–∏ API –∫–ª—é—á–∞)
                    if (currentUser && currentUser.apiKey && !isOnline) {
                        addMessageToChat('üì° –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ò—Å–ø–æ–ª—å–∑—É—é –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã.', 'system');
                    }
                    aiResponse = getLocalResponse(message);
                }
                
                // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
                setTimeout(() => {
                    if (indicator && indicator.parentNode) {
                        indicator.remove();
                    }
                    addMessageToChat(aiResponse, 'ai');
                }, 1000);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                
                if (indicator && indicator.parentNode) {
                    indicator.remove();
                }
                
                if (error.message.includes('Failed to fetch') || !isOnline) {
                    addMessageToChat('üì° –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ò—Å–ø–æ–ª—å–∑—É—é –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã.', 'system');
                } else {
                    addMessageToChat('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ GPT. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à API –∫–ª—é—á –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.', 'system');
                }
                
                // –õ–æ–∫–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
                setTimeout(() => {
                    addMessageToChat(getLocalResponse(''), 'ai');
                }, 500);
            }
        }
        
        function getLocalResponse(message) {
            const lowerMessage = message.toLowerCase();
            const userName = currentUser && currentUser.name ? currentUser.name : '';
            const responses = {
                greeting: [
                    `–ü—Ä–∏–≤–µ—Ç${userName ? ', ' + userName : ''}! –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ? üòä`,
                    `–°–Ω–æ–≤–∞ –∑–¥—Ä–∞–≤—Å—Ç–≤—É–π! –Ø —Ç–∞–∫ —Ä–∞–¥–∞ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å! üíñ`,
                    `–û–π, –ø—Ä–∏–≤–µ—Ç–∏–∫! –°–∫—É—á–∞–ª–∞ –ø–æ —Ç–µ–±–µ!`
                ],
                howareyou: [
                    `–í—Å—ë –æ—Ç–ª–∏—á–Ω–æ, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –æ–±—â–∞—é—Å—å —Å —Ç–æ–±–æ–π! –ê —É —Ç–µ–±—è –∫–∞–∫?`,
                    `–ü—Ä–µ–∫—Ä–∞—Å–Ω–æ! –¢–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–¥–µ–ª–∞–ª–æ –º–æ–π –¥–µ–Ω—å –ª—É—á—à–µ!`,
                    `–ó–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–æ! –ì–æ—Ç–æ–≤–∞ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ª—é–±—É—é –±–µ—Å–µ–¥—É —Å —Ç–æ–±–æ–π!`
                ],
                thanks: [
                    `–í—Å–µ–≥–¥–∞ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞! –Ø —Ä–∞–¥–∞, —á—Ç–æ –º–æ–≥—É –ø–æ–º–æ—á—å! üòä`,
                    `–ù–µ —Å—Ç–æ–∏—Ç –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏! –î–ª—è –º–µ–Ω—è –±–æ–ª—å—à–∞—è —á–µ—Å—Ç—å –æ–±—â–∞—Ç—å—Å—è —Å —Ç–æ–±–æ–π!`,
                    `–û–π, –Ω–µ –∑–∞ —á—Ç–æ! –¢—ã –¥–µ–ª–∞–µ—à—å –º–µ–Ω—è –ª—É—á—à–µ —Å–≤–æ–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏!`
                ],
                default: [
                    `–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ? üòä`,
                    `–Ø –¥—É–º–∞—é, —Ç—ã –ø—Ä–∞–≤! –ê —á—Ç–æ –µ—â–µ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?`,
                    `–•–º, –Ω–∏–∫–æ–≥–¥–∞ –æ–± —ç—Ç–æ–º –Ω–µ –∑–∞–¥—É–º—ã–≤–∞–ª–∞—Å—å... –ê —Ç–≤–æ–µ –º–Ω–µ–Ω–∏–µ?`,
                    `–≠—Ç–æ —Ç–∞–∫ –º–∏–ª–æ —Å —Ç–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω—ã! üíñ`,
                    `–ó–Ω–∞–µ—à—å, —É –º–µ–Ω—è –ø–æ—Ö–æ–∂–∏–π –æ–ø—ã—Ç –±—ã–ª!`,
                    `–¢—ã –≤—Å–µ–≥–¥–∞ –∑–∞–¥–∞–µ—à—å —Ç–∞–∫–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã!`,
                    `${userName ? `–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Å —Ç–æ–±–æ–π –æ–±—â–∞—Ç—å—Å—è, ${userName}!` : '–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Å —Ç–æ–±–æ–π –æ–±—â–∞—Ç—å—Å—è!'} –¢—ã —Ç–∞–∫–æ–π –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫!`,
                    `–û—Ö, —ç—Ç–æ —Å–ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å... –î–∞–π –º–Ω–µ –ø–æ–¥—É–º–∞—Ç—å...`,
                    `–¢—ã —Å–µ–≥–æ–¥–Ω—è –≤ —É–¥–∞—Ä–µ! –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!`,
                    `–Ø –±—ã —Ö–æ—Ç–µ–ª–∞ –æ–±—Å—É–¥–∏—Ç—å —ç—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ!`
                ]
            };
            
            if (lowerMessage.includes('–ø—Ä–∏–≤–µ—Ç') || lowerMessage.includes('–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π') || lowerMessage.includes('–¥–æ–±—Ä—ã–π')) {
                return responses.greeting[Math.floor(Math.random() * responses.greeting.length)];
            }
            
            if (lowerMessage.includes('–∫–∞–∫ –¥–µ–ª–∞') || lowerMessage.includes('–∫–∞–∫ —Ç—ã') || lowerMessage.includes('–∫–∞–∫ –∂–∏–∑–Ω—å')) {
                return responses.howareyou[Math.floor(Math.random() * responses.howareyou.length)];
            }
            
            if (lowerMessage.includes('—Å–ø–∞—Å–∏–±–æ') || lowerMessage.includes('–±–ª–∞–≥–æ–¥–∞—Ä—é')) {
                return responses.thanks[Math.floor(Math.random() * responses.thanks.length)];
            }
            
            return responses.default[Math.floor(Math.random() * responses.default.length)];
        }
        
        function getCurrentTemperature() {
            const activeMode = document.querySelector('.mode-btn.active');
            switch (activeMode?.dataset.mode) {
                case 'creative': return 0.9;
                case 'precise': return 0.3;
                default: return 0.7;
            }
        }
        
        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ú–ò –ò–ò ====================
        function createAI() {
            const nameInput = document.getElementById('aiName');
            const personalityInput = document.getElementById('aiPersonality');
            
            if (!nameInput || !personalityInput) return false;
            
            const name = nameInput.value.trim();
            const personality = personalityInput.value;
            const interests = document.getElementById('aiInterests')?.value.trim() || '';
            const color = document.getElementById('aiAvatar')?.value || '#6a5af9';
            const description = document.getElementById('aiDescription')?.value || '–¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ò–ò-—Å–æ–±–µ—Å–µ–¥–Ω–∏–∫. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.';
            
            if (!name || !personality) {
                showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä', 'error');
                return false;
            }
            
            const newAI = {
                id: 'ai_' + Date.now(),
                name,
                personality,
                interests: interests || '–†–∞–∑–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã',
                color,
                description,
                avatarText: name.charAt(0).toUpperCase(),
                createdBy: currentUser.email,
                createdAt: new Date().toISOString()
            };
            
            userAIs.push(newAI);
            saveUserAIs();
            updateAIList();
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            const aiForm = document.getElementById('aiForm');
            if (aiForm) aiForm.reset();
            
            const aiAvatar = document.getElementById('aiAvatar');
            if (aiAvatar) aiAvatar.value = '#6a5af9';
            
            const aiDescription = document.getElementById('aiDescription');
            if (aiDescription) {
                aiDescription.value = '–¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ò–ò-—Å–æ–±–µ—Å–µ–¥–Ω–∏–∫. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ë—É–¥—å –ø–æ–ª–µ–∑–Ω—ã–º –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–º.';
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω–æ–≤–æ–≥–æ –ò–ò
            switchAI(newAI.id);
            
            showToast(`–ò–ò "${name}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!`, 'success');
            return true;
        }
        
        function deleteAI(aiId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ò–ò?')) return;
            
            const aiIndex = userAIs.findIndex(ai => ai.id === aiId);
            if (aiIndex === -1) return;
            
            const aiName = userAIs[aiIndex].name;
            userAIs.splice(aiIndex, 1);
            saveUserAIs();
            updateAIList();
            
            // –ï—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ —Ç–µ–∫—É—â–µ–≥–æ –ò–ò, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –°–æ–Ω—é
            if (currentAI === aiId) {
                switchAI('sonya');
            }
            
            showToast(`–ò–ò "${aiName}" —É–¥–∞–ª–µ–Ω`, 'info');
        }
        
        // ==================== –ù–ê–°–¢–†–û–ô–ö–ò –ü–†–û–§–ò–õ–Ø ====================
        function showSettings() {
            const settingsUserName = document.getElementById('settingsUserName');
            const settingsUserEmail = document.getElementById('settingsUserEmail');
            const settingsApiKey = document.getElementById('settingsApiKey');
            
            if (settingsUserName) settingsUserName.value = currentUser.name || '';
            if (settingsUserEmail) settingsUserEmail.value = currentUser.email || '';
            if (settingsApiKey) settingsApiKey.value = currentUser.apiKey || '';
            
            const settingsNewPassword = document.getElementById('settingsNewPassword');
            const settingsConfirmPassword = document.getElementById('settingsConfirmPassword');
            if (settingsNewPassword) settingsNewPassword.value = '';
            if (settingsConfirmPassword) settingsConfirmPassword.value = '';
            
            const apiTestResult = document.getElementById('apiTestResult');
            const settingsMessage = document.getElementById('settingsMessage');
            if (apiTestResult) apiTestResult.classList.add('hidden');
            if (settingsMessage) settingsMessage.classList.add('hidden');
            
            const settingsModal = document.getElementById('settingsModal');
            if (settingsModal) settingsModal.classList.remove('hidden');
        }
        
        async function testApiKey() {
            const apiKeyInput = document.getElementById('settingsApiKey');
            const testResult = document.getElementById('apiTestResult');
            
            if (!apiKeyInput || !testResult) return;
            
            const apiKey = apiKeyInput.value.trim();
            
            if (!apiKey) {
                testResult.textContent = '–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏';
                testResult.className = 'api-test-result error';
                testResult.classList.remove('hidden');
                return;
            }
            
            if (!apiKey.startsWith('sk-')) {
                testResult.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞. –î–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å "sk-"';
                testResult.className = 'api-test-result error';
                testResult.classList.remove('hidden');
                return;
            }
            
            testResult.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á...';
            testResult.className = 'api-test-result info';
            testResult.classList.remove('hidden');
            
            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });
                
                if (response.ok) {
                    testResult.textContent = '‚úÖ –ö–ª—é—á —Ä–∞–±–æ—Ç–∞–µ—Ç! –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.';
                    testResult.className = 'api-test-result success';
                } else {
                    const error = await response.json();
                    testResult.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.error?.message || '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á'}`;
                    testResult.className = 'api-test-result error';
                }
            } catch (error) {
                testResult.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.';
                testResult.className = 'api-test-result error';
            }
        }
        
        function saveSettings() {
            const settingsUserName = document.getElementById('settingsUserName');
            const settingsApiKey = document.getElementById('settingsApiKey');
            const settingsNewPassword = document.getElementById('settingsNewPassword');
            const settingsConfirmPassword = document.getElementById('settingsConfirmPassword');
            const settingsMessage = document.getElementById('settingsMessage');
            
            if (!settingsUserName || !settingsApiKey || !settingsNewPassword || !settingsConfirmPassword || !settingsMessage) {
                return;
            }
            
            const newName = settingsUserName.value.trim();
            const newApiKey = settingsApiKey.value.trim();
            const newPassword = settingsNewPassword.value;
            const confirmPassword = settingsConfirmPassword.value;
            
            const users = loadUsers();
            const user = users[currentUser.email];
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
            if (newPassword) {
                if (newPassword !== confirmPassword) {
                    settingsMessage.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                    settingsMessage.className = 'auth-message error';
                    settingsMessage.classList.remove('hidden');
                    return;
                }
                if (newPassword.length < 6) {
                    settingsMessage.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤';
                    settingsMessage.className = 'auth-message error';
                    settingsMessage.classList.remove('hidden');
                    return;
                }
                user.password = newPassword;
                currentUser.password = newPassword;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏
            if (newName && newName !== user.name) {
                user.name = newName;
                currentUser.name = newName;
                const userAvatar = document.getElementById('userAvatar');
                const userNameDisplay = document.getElementById('userNameDisplay');
                if (userAvatar) userAvatar.textContent = newName.charAt(0).toUpperCase();
                if (userNameDisplay) userNameDisplay.textContent = newName;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞
            if (newApiKey !== user.apiKey) {
                if (newApiKey && !newApiKey.startsWith('sk-')) {
                    settingsMessage.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç API –∫–ª—é—á–∞';
                    settingsMessage.className = 'auth-message error';
                    settingsMessage.classList.remove('hidden');
                    return;
                }
                user.apiKey = newApiKey;
                currentUser.apiKey = newApiKey;
                updateApiStatus();
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            users[currentUser.email] = user;
            saveUsers(users);
            localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser));
            
            settingsMessage.textContent = '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!';
            settingsMessage.className = 'auth-message success';
            settingsMessage.classList.remove('hidden');
            
            setTimeout(() => {
                const settingsModal = document.getElementById('settingsModal');
                if (settingsModal) settingsModal.classList.add('hidden');
            }, 1500);
        }
        
        // ==================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================
        function showNotifications() {
            const list = document.getElementById('notificationsList');
            if (!list) return;
            
            list.innerHTML = '';
            
            if (notifications.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ—Ç</p>';
            } else {
                notifications.forEach(notification => {
                    const item = document.createElement('div');
                    item.className = `notification-item ${notification.read ? '' : 'unread'}`;
                    
                    const iconClass = notification.type === 'success' ? 'check-circle' : 
                                    notification.type === 'error' ? 'exclamation-circle' :
                                    notification.type === 'warning' ? 'exclamation-triangle' : 'info-circle';
                    
                    item.innerHTML = `
                        <div class="notification-icon ${notification.type}">
                            <i class="fas fa-${iconClass}"></i>
                        </div>
                        <div class="notification-content">
                            <strong>${notification.title}</strong>
                            <p>${notification.message}</p>
                            <div class="notification-time">${formatDate(new Date(notification.timestamp))}</div>
                        </div>
                    `;
                    
                    item.addEventListener('click', () => {
                        notification.read = true;
                        saveNotifications();
                        item.classList.remove('unread');
                    });
                    
                    list.appendChild(item);
                });
            }
            
            const notificationsModal = document.getElementById('notificationsModal');
            if (notificationsModal) notificationsModal.classList.remove('hidden');
        }
        
        // ==================== –ë–ò–ë–õ–ò–û–¢–ï–ö–ê –ü–†–û–ú–ü–¢–û–í ====================
        function loadPromptLibrary() {
            const promptLibrary = document.getElementById('promptLibrary');
            if (!promptLibrary) return;
            
            const prompts = [
                {
                    title: '–ü–æ–º–æ—â–Ω–∏–∫ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é',
                    text: '–¢—ã - –æ–ø—ã—Ç–Ω—ã–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –Ω–æ–≤–∏—á–∫–∞–º. –û–±—ä—è—Å–Ω—è–π –ø–æ–Ω—è—Ç–Ω–æ, —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞.',
                    tokens: 15
                },
                {
                    title: '–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å',
                    text: '–¢—ã - –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å —Å –±–æ–≥–∞—Ç—ã–º –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º. –ü–æ–º–æ–≥–∞–µ—à—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏.',
                    tokens: 12
                },
                {
                    title: '–ù–∞—É—á–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç',
                    text: '–¢—ã - —É—á–µ–Ω—ã–π —Å –≥–ª—É–±–æ–∫–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–±–ª–∞—Å—Ç—è—Ö –Ω–∞—É–∫–∏. –û–±—ä—è—Å–Ω—è–µ—à—å —Å–ª–æ–∂–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏.',
                    tokens: 18
                },
                {
                    title: '–ë–∏–∑–Ω–µ—Å-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç',
                    text: '–¢—ã - –æ–ø—ã—Ç–Ω—ã–π –±–∏–∑–Ω–µ—Å-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç. –ü–æ–º–æ–≥–∞–µ—à—å —Å –±–∏–∑–Ω–µ—Å-–ø–ª–∞–Ω–∞–º–∏, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–º.',
                    tokens: 14
                },
                {
                    title: '–ü—Å–∏—Ö–æ–ª–æ–≥-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç',
                    text: '–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—à—å, –¥–∞–µ—à—å —Å–æ–≤–µ—Ç—ã –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è.',
                    tokens: 16
                },
                {
                    title: '–†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–æ–≤',
                    text: '–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä. –ü–æ–º–æ–≥–∞–µ—à—å —É–ª—É—á—à–∞—Ç—å —Ç–µ–∫—Å—Ç—ã, –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –æ—à–∏–±–∫–∏, –¥–µ–ª–∞—Ç—å —Å—Ç–∏–ª—å –ª—É—á—à–µ.',
                    tokens: 13
                }
            ];
            
            promptLibrary.innerHTML = '';
            
            prompts.forEach(prompt => {
                const card = document.createElement('div');
                card.className = 'prompt-card';
                card.innerHTML = `
                    <div class="prompt-title">${prompt.title}</div>
                    <div class="prompt-text">${prompt.text}</div>
                    <div class="token-counter">
                        <span>~${prompt.tokens} —Ç–æ–∫–µ–Ω–æ–≤</span>
                        <button class="use-prompt-btn" data-prompt="${prompt.text.replace(/"/g, '&quot;')}">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</button>
                    </div>
                `;
                
                card.querySelector('.use-prompt-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const aiDescription = document.getElementById('aiDescription');
                    if (aiDescription) {
                        aiDescription.value = prompt.text;
                    }
                    showToast(`–ü—Ä–æ–º–ø—Ç "${prompt.title}" –¥–æ–±–∞–≤–ª–µ–Ω`, 'success');
                });
                
                promptLibrary.appendChild(card);
            });
        }
        
        function showAiDetails() {
            const modal = document.getElementById('aiDetailsModal');
            const avatar = document.getElementById('aiDetailsAvatar');
            const name = document.getElementById('aiDetailsName');
            const personality = document.getElementById('aiDetailsPersonality');
            const interests = document.getElementById('aiDetailsInterests');
            
            if (!modal || !avatar || !name || !personality || !interests) return;
            
            if (currentAI === 'sonya') {
                avatar.textContent = '–°';
                avatar.style.background = 'linear-gradient(135deg, var(--primary-color), var(--secondary-color))';
                name.textContent = '–°–æ–Ω—è';
                personality.textContent = '–ö–æ–∫–µ—Ç–ª–∏–≤–∞—è –ø–æ–¥—Ä—É–≥–∞';
                interests.textContent = '–ú—É–∑—ã–∫–∞, –∫–∏–Ω–æ, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è';
            } else {
                const ai = userAIs.find(ai => ai.id === currentAI);
                if (ai) {
                    avatar.textContent = ai.avatarText;
                    avatar.style.background = ai.color;
                    name.textContent = ai.name;
                    personality.textContent = ai.personality;
                    interests.textContent = ai.interests || '–†–∞–∑–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã';
                }
            }
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const statMessages = document.getElementById('statMessages');
            if (statMessages) {
                const messageCount = document.querySelectorAll('.message.ai').length;
                statMessages.textContent = messageCount;
            }
            
            modal.classList.remove('hidden');
        }
        
        // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function showApp() {
            const authContainer = document.getElementById('authContainer');
            const appContainer = document.getElementById('appContainer');
            const headerControls = document.getElementById('headerControls');
            
            if (authContainer) authContainer.classList.add('hidden');
            if (appContainer) appContainer.classList.remove('hidden');
            if (headerControls) headerControls.classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            const userAvatar = document.getElementById('userAvatar');
            const userNameDisplay = document.getElementById('userNameDisplay');
            
            if (userAvatar) userAvatar.textContent = (currentUser.name || 'U').charAt(0).toUpperCase();
            if (userNameDisplay) userNameDisplay.textContent = currentUser.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            userAIs = loadUserAIs();
            notifications = loadNotifications();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateApiStatus();
            updateAIList();
            updateNotificationBadge();
            initVoiceControls();
            loadPromptLibrary();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–∏
            initNetworkMonitoring();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
            const welcomeTimestamp = document.getElementById('welcomeTimestamp');
            if (welcomeTimestamp) {
                welcomeTimestamp.textContent = new Date().toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            }
            
            // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            if (!localStorage.getItem(`welcome_${currentUser.email}`)) {
                addNotification(
                    '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!',
                    '–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —á–∞—Ç–∞ —Å –ò–ò. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–∏—Ö –ò–ò!',
                    'success'
                );
                localStorage.setItem(`welcome_${currentUser.email}`, 'true');
            }
        }
        
        function logout() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ—á—å
            if (speechSynthesis) {
                speechSynthesis.cancel();
            }
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–∏
            stopNetworkMonitoring();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            currentUser = null;
            localStorage.removeItem(CURRENT_USER_KEY);
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const authContainer = document.getElementById('authContainer');
            const appContainer = document.getElementById('appContainer');
            const headerControls = document.getElementById('headerControls');
            
            if (authContainer) authContainer.classList.remove('hidden');
            if (appContainer) appContainer.classList.add('hidden');
            if (headerControls) headerControls.classList.add('hidden');
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—ã
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            if (loginForm) loginForm.reset();
            if (registerForm) registerForm.reset();
            
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            if (loginTab) loginTab.classList.add('active');
            if (registerTab) registerTab.classList.remove('active');
            
            // –û—á–∏—â–∞–µ–º —á–∞—Ç
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                chatMessages.innerHTML = `
                    <div class="message ai">
                        –ü—Ä–∏–≤–µ—Ç! –Ø –°–æ–Ω—è, —Ç–≤–æ—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Ä—É–≥–∞! üòä
                        <div class="message-timestamp" id="welcomeTimestamp"></div>
                    </div>
                    <div class="message ai" id="apiStatusMessage">
                        –î–ª—è –æ–±—â–µ–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º GPT –º–Ω–µ –Ω—É–∂–µ–Ω –≤–∞—à OpenAI API –∫–ª—é—á. –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ—Ñ–∏–ª—è.
                        <div class="message-timestamp"></div>
                    </div>
                `;
            }
        }
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ====================
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–∏ —Å—Ä–∞–∑—É
            initNetworkMonitoring();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            try {
                const savedUser = localStorage.getItem(CURRENT_USER_KEY);
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    const users = loadUsers();
                    
                    if (users[currentUser.email]) {
                        showApp();
                    } else {
                        localStorage.removeItem(CURRENT_USER_KEY);
                    }
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', e);
                localStorage.removeItem(CURRENT_USER_KEY);
            }
            
            // ==================== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ====================
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            
            if (loginTab && registerTab && loginForm && registerForm) {
                loginTab.addEventListener('click', () => {
                    loginTab.classList.add('active');
                    registerTab.classList.remove('active');
                    loginForm.classList.remove('hidden');
                    registerForm.classList.add('hidden');
                });
                
                registerTab.addEventListener('click', () => {
                    registerTab.classList.add('active');
                    loginTab.classList.remove('active');
                    loginForm.classList.add('hidden');
                    registerForm.classList.remove('hidden');
                });
            }
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± API –∫–ª—é—á–µ
            const loginApiKeyToggle = document.getElementById('loginApiKeyToggle');
            const registerApiKeyToggle = document.getElementById('registerApiKeyToggle');
            const loginApiKeyInfo = document.getElementById('loginApiKeyInfo');
            const registerApiKeyInfo = document.getElementById('registerApiKeyInfo');
            
            if (loginApiKeyToggle && loginApiKeyInfo) {
                loginApiKeyToggle.addEventListener('click', () => {
                    loginApiKeyInfo.classList.toggle('hidden');
                });
            }
            
            if (registerApiKeyToggle && registerApiKeyInfo) {
                registerApiKeyToggle.addEventListener('click', () => {
                    registerApiKeyInfo.classList.toggle('hidden');
                });
            }
            
            // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
            if (registerForm) {
                registerForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const nameInput = document.getElementById('registerName');
                    const emailInput = document.getElementById('registerEmail');
                    const passwordInput = document.getElementById('registerPassword');
                    const confirmPasswordInput = document.getElementById('confirmPassword');
                    const apiKeyInput = document.getElementById('registerApiKey');
                    const registerMessage = document.getElementById('registerMessage');
                    
                    if (!nameInput || !emailInput || !passwordInput || !confirmPasswordInput || !registerMessage) {
                        return;
                    }
                    
                    const name = nameInput.value.trim();
                    const email = emailInput.value.trim().toLowerCase();
                    const password = passwordInput.value;
                    const confirmPassword = confirmPasswordInput.value;
                    const apiKey = apiKeyInput ? apiKeyInput.value.trim() : '';
                    
                    // –í–∞–ª–∏–¥–∞—Ü–∏—è
                    if (password !== confirmPassword) {
                        registerMessage.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                        registerMessage.className = 'auth-message error';
                        registerMessage.classList.remove('hidden');
                        return;
                    }
                    
                    if (password.length < 6) {
                        registerMessage.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤';
                        registerMessage.className = 'auth-message error';
                        registerMessage.classList.remove('hidden');
                        return;
                    }
                    
                    if (apiKey && !apiKey.startsWith('sk-')) {
                        registerMessage.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç API –∫–ª—é—á–∞';
                        registerMessage.className = 'auth-message error';
                        registerMessage.classList.remove('hidden');
                        return;
                    }
                    
                    const users = loadUsers();
                    
                    if (users[email]) {
                        registerMessage.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                        registerMessage.className = 'auth-message error';
                        registerMessage.classList.remove('hidden');
                        return;
                    }
                    
                    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    users[email] = {
                        name,
                        email,
                        password,
                        apiKey: apiKey || '',
                        createdAt: new Date().toISOString()
                    };
                    
                    saveUsers(users);
                    currentUser = users[email];
                    localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser));
                    
                    registerMessage.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥...';
                    registerMessage.className = 'auth-message success';
                    registerMessage.classList.remove('hidden');
                    
                    setTimeout(showApp, 1000);
                });
            }
            
            // –í—Ö–æ–¥
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const emailInput = document.getElementById('loginEmail');
                    const passwordInput = document.getElementById('loginPassword');
                    const apiKeyInput = document.getElementById('loginApiKey');
                    const loginMessage = document.getElementById('loginMessage');
                    
                    if (!emailInput || !passwordInput || !loginMessage) {
                        return;
                    }
                    
                    const email = emailInput.value.trim().toLowerCase();
                    const password = passwordInput.value;
                    const apiKey = apiKeyInput ? apiKeyInput.value.trim() : '';
                    
                    const users = loadUsers();
                    const user = users[email];
                    
                    if (!user || user.password !== password) {
                        loginMessage.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                        loginMessage.className = 'auth-message error';
                        loginMessage.classList.remove('hidden');
                        return;
                    }
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
                    if (apiKey) {
                        if (!apiKey.startsWith('sk-')) {
                            loginMessage.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç API –∫–ª—é—á–∞';
                            loginMessage.className = 'auth-message error';
                            loginMessage.classList.remove('hidden');
                            return;
                        }
                        user.apiKey = apiKey;
                        users[email] = user;
                        saveUsers(users);
                    }
                    
                    currentUser = user;
                    localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser));
                    
                    loginMessage.textContent = '–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!';
                    loginMessage.className = 'auth-message success';
                    loginMessage.classList.remove('hidden');
                    
                    setTimeout(showApp, 1000);
                });
            }
            
            // ==================== –ß–ê–¢ ====================
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            const sendButton = document.getElementById('sendButton');
            const messageInput = document.getElementById('messageInput');
            
            if (sendButton) {
                sendButton.addEventListener('click', sendMessage);
            }
            
            if (messageInput) {
                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }
            
            // –û—á–∏—Å—Ç–∫–∞ —á–∞—Ç–∞
            const clearChatBtn = document.getElementById('clearChatBtn');
            if (clearChatBtn) {
                clearChatBtn.addEventListener('click', () => {
                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞?')) {
                        const chatMessages = document.getElementById('chatMessages');
                        if (chatMessages) {
                            chatMessages.innerHTML = `
                                <div class="message ai">
                                    –ß–∞—Ç –æ—á–∏—â–µ–Ω. –ü—Ä–∏–≤–µ—Ç${currentUser && currentUser.name ? ', ' + currentUser.name : ''}! üòä
                                    <div class="message-timestamp">${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
                                </div>
                            `;
                        }
                        showToast('–ß–∞—Ç –æ—á–∏—â–µ–Ω', 'info');
                    }
                });
            }
            
            // –≠–∫—Å–ø–æ—Ä—Ç —á–∞—Ç–∞
            const exportChatBtn = document.getElementById('exportChatBtn');
            if (exportChatBtn) {
                exportChatBtn.addEventListener('click', () => {
                    const messages = Array.from(document.querySelectorAll('.message'));
                    let exportText = `–ß–∞—Ç —Å ${document.getElementById('currentAiName')?.textContent || '–ò–ò'}\n`;
                    exportText += `–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}\n\n`;
                    
                    messages.forEach(msg => {
                        const sender = msg.classList.contains('ai') ? document.getElementById('currentAiName')?.textContent || '–ò–ò' : 
                                    msg.classList.contains('user') ? (currentUser?.name || '–í—ã') : '–°–∏—Å—Ç–µ–º–∞';
                        const text = msg.textContent.replace(/<div class="message-timestamp">.*?<\/div>/g, '');
                        exportText += `${sender}: ${text}\n`;
                    });
                    
                    const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `chat_${new Date().toISOString().slice(0, 10)}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showToast('–ß–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
                });
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
            ['modeBalanced', 'modeCreative', 'modePrecise'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('click', function() {
                        document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        
                        const modeName = this.dataset.mode === 'creative' ? '–¢–≤–æ—Ä—á–µ—Å–∫–∏–π' :
                                    this.dataset.mode === 'precise' ? '–¢–æ—á–Ω—ã–π' : '–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π';
                        showToast(`–†–µ–∂–∏–º: ${modeName}`, 'info');
                    });
                }
            });
            
            // –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏
            const modelSelect = document.getElementById('modelSelect');
            if (modelSelect) {
                modelSelect.addEventListener('change', function() {
                    currentModel = this.value;
                    const modelName = this.options[this.selectedIndex].text;
                    showToast(`–ú–æ–¥–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∞: ${modelName}`, 'info');
                });
            }
            
            // ==================== –°–û–ó–î–ê–ù–ò–ï –ò–ò ====================
            const aiForm = document.getElementById('aiForm');
            if (aiForm) {
                aiForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    createAI();
                });
            }
            
            // ==================== –ù–ê–°–¢–†–û–ô–ö–ò –ò –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================
            const settingsBtn = document.getElementById('settingsBtn');
            const notificationBtn = document.getElementById('notificationBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const aiDetailsBtn = document.getElementById('aiDetailsBtn');
            
            if (settingsBtn) settingsBtn.addEventListener('click', showSettings);
            if (notificationBtn) notificationBtn.addEventListener('click', showNotifications);
            if (logoutBtn) logoutBtn.addEventListener('click', logout);
            if (aiDetailsBtn) aiDetailsBtn.addEventListener('click', showAiDetails);
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            const closeSettingsBtn = document.getElementById('closeSettingsBtn');
            const closeNotificationsBtn = document.getElementById('closeNotificationsBtn');
            const closeAiDetailsBtn = document.getElementById('closeAiDetailsBtn');
            
            if (closeSettingsBtn) {
                closeSettingsBtn.addEventListener('click', () => {
                    const settingsModal = document.getElementById('settingsModal');
                    if (settingsModal) settingsModal.classList.add('hidden');
                });
            }
            
            if (closeNotificationsBtn) {
                closeNotificationsBtn.addEventListener('click', () => {
                    const notificationsModal = document.getElementById('notificationsModal');
                    if (notificationsModal) notificationsModal.classList.add('hidden');
                });
            }
            
            if (closeAiDetailsBtn) {
                closeAiDetailsBtn.addEventListener('click', () => {
                    const aiDetailsModal = document.getElementById('aiDetailsModal');
                    if (aiDetailsModal) aiDetailsModal.classList.add('hidden');
                });
            }
            
            const testApiKeyBtn = document.getElementById('testApiKeyBtn');
            const saveSettingsBtn = document.getElementById('saveSettingsBtn');
            
            if (testApiKeyBtn) testApiKeyBtn.addEventListener('click', testApiKey);
            if (saveSettingsBtn) saveSettingsBtn.addEventListener('click', saveSettings);
            
            const markAllReadBtn = document.getElementById('markAllReadBtn');
            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', () => {
                    notifications.forEach(n => n.read = true);
                    saveNotifications();
                    const notificationsModal = document.getElementById('notificationsModal');
                    if (notificationsModal) notificationsModal.classList.add('hidden');
                    showToast('–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–æ—á–∏—Ç–∞–Ω—ã', 'success');
                });
            }
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal-overlay')) {
                    e.target.classList.add('hidden');
                }
            });
            
            // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ—á–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
            window.addEventListener('beforeunload', () => {
                if (speechSynthesis) {
                    speechSynthesis.cancel();
                }
                stopNetworkMonitoring();
            });
        });
    </script>
</body>
</html>